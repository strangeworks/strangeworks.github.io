<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing software on "dead" technologies | On verbosity of express endpoints.</title>
  <meta name="description" content="Hacking with express middlewares for fun and profit">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="On verbosity of express endpoints.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://nohype.tech/posts/on-verbosity-of-express-endpoints">
  <meta property="og:description" content="Hacking with express middlewares for fun and profit">
  <meta property="og:site_name" content="Writing software on "dead" technologies">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://nohype.tech/posts/on-verbosity-of-express-endpoints">
  <meta name="twitter:title" content="On verbosity of express endpoints.">
  <meta name="twitter:description" content="Hacking with express middlewares for fun and profit">

  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
  <link href="http://nohype.tech/feed.xml" type="application/rss+xml" rel="alternate" title="Writing software on "dead" technologies Last 10 blog posts" />

  
    <link type="text/css" rel="stylesheet" href="/assets/light.css">
  
</head>

<body>
  <main role="main">
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav reveal">
  <a href="/" class="header-logo" title="Writing software on "dead" technologies">Writing software on "dead" technologies</a>
  <ul class="header-links">
    
    
      <li>
        <a href="https://twitter.com/makefunstuff" target="_blank" title="Twitter">
          <span class="icon icon-social-twitter"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/strangeworks" target="_blank" title="GitHub">
          <span class="icon icon-social-github"></span>
        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/plugataryov-yura-b1271064" target="_blank" title="LinkedIn">
          <span class="icon icon-social-linkedin"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="mailto:plugatariov@gmail.com" title="Email">
          <span class="icon icon-at"></span>
        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" target="_blank" title="RSS">
          <span class="icon icon-social-rss"></span>
        </a>
      </li>
    
    <li>
      <a href="/about" title="About me">
        <span class="icon icon-person"></span>
      </a>
    </li>
  </ul>
</nav>

        <article class="article reveal">
          <header class="article-header">
            <h1>On verbosity of express endpoints.</h1>
            <p>Hacking with express middlewares for fun and profit</p>
            <div class="article-list-footer">
              <span class="article-list-date">
                February 25, 2017
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  8 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/node">node</a>
                
                  <a href="/tag/express">express</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <p><a href="/assets/posts/bolongese.png" class="fluidbox-trigger">
  <img src="/assets/posts/bolongese.png" alt="Javascript Bolongese" />
</a></p>

<p><strong><em>image borrowed from <a href="https://www.flickr.com/photos/50158183@N00/388654424/in/photolist-AkXqc-AkXqm-AkXqf-4J9Q6r-jwvZYX-99rnRc-Axex2-9UQ4oT-bQq7CB-9jAyhU-52knk-ji45gE-8dX1z2-AMWU68-7MPr9T-bB2sEd-cnP9C-ji1KqL-7fYr6L-4YK6M-4JdYQU-4J9Anp-4JdJCQ-jhYWUT-eJa6B-ji45XE-4J9DcF-4W5mmn-4Je2gG-jwwUbo-b2pe4Z-hYjFox-6aJBsD-4J9FN4-be1AdV-yKC8qt-ojGLgz-nf3an6-jwuQ4k-jww2fK">flickr</a></em></strong></p>

<p>There is a very high risk of writing JavaScript bolognese 
in express endpoints, and sometimes we can’t notice how flexible express 
can be even with this minimalistic toolset that it gives out of the box. 
In this post I would like to share some thoughts about proper definition of express 
endpoint and what can be delegated to middlewares to make codebase as much reusable as possible. 
Before starting to read this small <strong><em>disclaimer</em></strong>: these ideas is applicable 
in case when you know that that your express app will grow in terms of codebase 
if not this post will be more harmful rather than useful. 
After this quick warning moment let’s get started.</p>

<p>Sometimes you have some custom ecosystem of logging, error responses, success responses. 
Below you can see the most common express endpoint flow.</p>

<p><a href="/assets/posts/express-request-flow.png" class="fluidbox-trigger">
  <img src="/assets/posts/express-request-flow.png" alt="Endpoint Request Flow" />
</a></p>

<h2 id="welcome-to-the-spaghetti-world">Welcome to the spaghetti world</h2>

<p>In any express project we always have endpoints, where we have the following flow: 
client initiates simple http request and expects some json data.
Under the hood we have bunch of operations such as asynchronous database calls, 
fetching some data from 3rd party api, logging success state, 
tracking data to some 3rd party apis and responding with success payload, 
in our example let’s assume that client expects son only when everything is ok.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"> <span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/data/:id/filtered'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
     <span class="kr">const</span> <span class="p">{</span> <span class="nx">id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>

     <span class="nx">database</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
         <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
             <span class="nx">logger</span><span class="p">(</span><span class="s1">'[INFO] data is received'</span><span class="p">);</span>
             <span class="nx">tracking</span><span class="p">(</span><span class="s1">'data.received'</span><span class="p">,</span> <span class="p">{</span><span class="na">id</span><span class="p">:</span> <span class="nx">id</span><span class="p">});</span>
             <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
         <span class="p">})</span>
         <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">dataFilterService</span><span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="nx">data</span><span class="p">}))</span>
         <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">apiResult</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
             <span class="nx">logger</span><span class="p">(</span><span class="s1">'[INFO] data is filtered'</span><span class="p">);</span>
             <span class="nx">tracking</span><span class="p">(</span><span class="s1">'api.result.received'</span><span class="p">);</span>
             <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">apiResult</span><span class="p">);</span>
         <span class="p">})</span>
         <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
             <span class="nx">logger</span><span class="p">(</span><span class="s1">'[ERROR] '</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
             <span class="nx">exceptionCatcher</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
             <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
                 <span class="na">error</span><span class="p">:</span> <span class="s1">'Something went wrong'</span>
             <span class="p">});</span>
         <span class="p">});</span>
 <span class="p">});</span>
 </code></pre></figure>

<p>Looking at this small example you may notice that some 
 parts of this endpoints leaks more details that may seems that 
 it is out this endpoint responsibility?</p>

<p>After working with dozens of different express apps 
 I have noticed that middleware layer is pretty underused, almost everywhere 
 it is used only as some tiny request processing tool. 
 Yes obviously it is intended to do such thing and it does it pretty well but sometimes 
 I can see that there is a bit chance to produce code duplications and start testing 
 more than needed. What express routes intended to do? 
 Does express route need to know more than a single thing, 
 how can we leverage single responsive principle in our example?
 In our first example the responsibility of the endpoint 
 is to send processed data entry by certain identifier provided by client. 
 If we have only this endpoint this code looks more or less ok. 
 Let’s assume that we also need to fetch raw data entry 
 without initiating any processing service.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/data/:entry_id'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">entry_id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
    
    <span class="nx">database</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">logger</span><span class="p">(</span><span class="s1">'[ERROR] '</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
            <span class="nx">exceptionCatcher</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
                <span class="na">error</span><span class="p">:</span> <span class="s1">'Something went wrong'</span>
            <span class="p">});</span>
        <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<p>As you may notice we are introducing more complexity in our codebase by adding duplication 
which sounds like a great target for refactoring. How can we DRY this endpoints.
First of all let’s pay attention to error handling in both examples? 
You probably may notice that first we can do is provide utility 
function for error handling and require it in both modules. 
But as we are using express why no to leverage built-in middleware layer in this case.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">logger</span><span class="p">(</span><span class="s1">'[ERROR] '</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="nx">exceptionCatcher</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">error</span><span class="p">:</span> <span class="s1">'Something went wrong'</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></figure>

<h2 id="what-did-we-achieve-after-that">What did we achieve after that?</h2>

<p>First of all we got rid out of one external dependency 
that we may stub in our tests, and obviously 
this dependency tell us nothing about real intention of this endpoint. 
When you are ordering a cup of coffee your outcome should be mug of coffee and you don’t 
want to hear from they guy who helps barista to repair coffee machine because of N reasons, 
in our case repair guy is external dependency that we are encapsulating in middleware 
that does one thing and does it properly.
Let’s look at the outcome.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/data/:entry_id'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">entry_id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
    
    <span class="nx">database</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">logger</span><span class="p">(</span><span class="s1">'[INFO] data is received'</span><span class="p">);</span>
            <span class="nx">tracking</span><span class="p">(</span><span class="s1">'data.received'</span><span class="p">,</span> <span class="p">{</span><span class="na">id</span><span class="p">:</span> <span class="nx">id</span><span class="p">});</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">next</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/data/:entry_id/filtered'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">entry_id</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
    
    <span class="nx">database</span><span class="p">.</span><span class="nx">getById</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">dataFilterService</span><span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="nx">data</span><span class="p">}))</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">apiResult</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">logger</span><span class="p">(</span><span class="s1">'[INFO] data is filtered'</span><span class="p">);</span>
            <span class="nx">tracking</span><span class="p">(</span><span class="s1">'api.result.received'</span><span class="p">);</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">apiResult</span><span class="p">);</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">next</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>This refactoring looks very tiny but it doesn’t mean that benefit is tiny as well,
in this case you don’t need to test things that are out of ones responsibility.</p>

<h3 id="what-can-we-do-next">What can we do next?</h3>
<p>You may noticed that fetching from params and next 
from database is also looks like copy paste driven development, 
which will also may cause possible issues.
Let’s assume that we plan to add more endpoints that will 
lookup by entry_id parameter, will we constantly copy and paste this data fetching behaviour? 
Is there any express way to solve this problem? 
If we pay attention to express documentation express gives us nifty feature 
of declaring <a href="http://expressjs.com/en/api.html#app.param">param</a> based middleware 
why not to use this? But before let’s think about conceptual idea of request lifecycle in express app.</p>

<p><a href="/assets/posts/express-request-object-flow.png" class="fluidbox-trigger">
  <img src="/assets/posts/express-request-object-flow.png" alt="Request Oject Flow" />
</a></p>

<p>In express we can have as much middlewares as it is is possible which means that we can pre-process our 
request object adding additional keys and values before it goes to final destination e.g. client.
So what does it mean for us? It means that we can make loose 
coupled middleware functions that can be reused all over our application logic 
which will lead us to less code when our system will be extended.</p>

<p>So let’s define our param handler:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">'entry_id'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">,</span> <span class="nx">entry_id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>    
    <span class="nx">getDataById</span><span class="p">(</span><span class="nx">entry_id</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">req</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="na">info</span><span class="p">:</span> <span class="s1">'data is received'</span><span class="p">,</span>
                <span class="na">event</span><span class="p">:</span> <span class="s1">'data.received'</span>
            <span class="p">};</span>
            
            <span class="nx">req</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>

            <span class="nx">next</span><span class="p">();</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">next</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>Looking at this small code you may notice that we provided additional 
metadata to our request object plus mixed in result of database query. 
So after we extracted common data fetching from route param we can extract common 
code to DRY our express endpoints and the result will look like this:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/data/:entry_id'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/data/:entry_id/filtered'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>    
    <span class="nx">dataFilterService</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">apiResult</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">req</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="na">info</span><span class="p">:</span> <span class="s1">'data is filtered'</span><span class="p">,</span>
                <span class="na">event</span><span class="p">:</span> <span class="s1">'api.result.received'</span>
            <span class="p">}</span>
            
            <span class="nx">req</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">apiResult</span><span class="p">;</span>
            <span class="nx">next</span><span class="p">();</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">next</span><span class="p">);</span>
<span class="p">});</span></code></pre></figure>

<p>After this changes applied we removed bunch of duplications 
from both our endpoints plus we have introduced single responsibility principle, 
our endpoints does only one thing.
But where is response and logging and tracking you may ask? 
And here is the most controversial part of this post. 
According to our diagram we can pass request using by calling 
next function to other middlewares and work with our 
request until we hit req.end or finalise its lifecycle in one of our middlewares.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// tracker middleware</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tracking</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">event</span><span class="p">);</span>
        <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// logger middleware</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">'/data'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">logger</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">info</span><span class="p">);</span>
        <span class="nx">next</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// responder middleware</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">next</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Result not found'</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<p>So after this changes we will have decoupled tiny middlewares and we can and make 
our subsystems as much reusable as possible. 
I’m not sure that it is the best idea ever 
but in terms of testability of each subcomponent 
it looks more than reasonable to do this for bigger express applications.</p>

<p>If you are interested and wan’t to play with code examples you can use this <a href="https://gist.github.com/strangeworks/fe9b279ca6c00f0923cad94135af2de6">gist</a>, 
thank you for your time spent of this long read, I hope it was useful</p>

          </div>

          <div class="article-share">
            
            <a href="" title="Share on Twitter" onclick="window.open('https://twitter.com/home?status=On verbosity of express endpoints. - http://nohype.tech/posts/on-verbosity-of-express-endpoints by @makefunstuff', 'newwindow', 'width=500, height=225'); return false;" data-turbolinks="false">
              <svg enable-background="new 0 0 128 128" width="15px" version="1.1" viewBox="0 0 128 128" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x37__stroke"><g id="Twitter"><rect clip-rule="evenodd" fill="none" fill-rule="evenodd" height="128" width="128"/><path clip-rule="evenodd" d="M128,23.294    c-4.703,2.142-9.767,3.59-15.079,4.237c5.424-3.328,9.587-8.606,11.548-14.892c-5.079,3.082-10.691,5.324-16.687,6.526    c-4.778-5.231-11.608-8.498-19.166-8.498c-14.493,0-26.251,12.057-26.251,26.927c0,2.111,0.225,4.16,0.676,6.133    C41.217,42.601,21.871,31.892,8.91,15.582c-2.261,3.991-3.554,8.621-3.554,13.552c0,9.338,4.636,17.581,11.683,22.412    c-4.297-0.131-8.355-1.356-11.901-3.359v0.331c0,13.051,9.053,23.937,21.074,26.403c-2.201,0.632-4.523,0.948-6.92,0.948    c-1.69,0-3.343-0.162-4.944-0.478c3.343,10.694,13.035,18.483,24.53,18.691c-8.986,7.227-20.315,11.533-32.614,11.533    c-2.119,0-4.215-0.123-6.266-0.37c11.623,7.627,25.432,12.088,40.255,12.088c48.309,0,74.717-41.026,74.717-76.612    c0-1.171-0.023-2.342-0.068-3.49C120.036,33.433,124.491,28.695,128,23.294" fill-rule="evenodd" id="Twitter_1_"/></g></g></svg>
            </a>
            <a href="" title="Share on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=http://nohype.tech/posts/on-verbosity-of-express-endpoints', 'newwindow', 'width=500, height=500'); return false;" data-turbolinks="false">
              <svg enable-background="new 0 0 128 128" width="15px" version="1.1" viewBox="0 0 128 128" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x31__stroke"><g id="Facebook_1_"><rect fill="none" height="128" width="128"/><path clip-rule="evenodd" d="M68.369,128H7.065C3.162,128,0,124.836,0,120.935    V7.065C0,3.162,3.162,0,7.065,0h113.871C124.837,0,128,3.162,128,7.065v113.87c0,3.902-3.163,7.065-7.064,7.065H88.318V78.431    h16.638l2.491-19.318H88.318V46.78c0-5.593,1.553-9.404,9.573-9.404l10.229-0.004V20.094c-1.769-0.235-7.841-0.761-14.906-0.761    c-14.749,0-24.846,9.003-24.846,25.535v14.246H51.688v19.318h16.681V128z" fill-rule="evenodd" id="Facebook"/></g></g></svg>
            </a>
            <a href="" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=http://nohype.tech/posts/on-verbosity-of-express-endpoints', 'newwindow', 'width=550, height=400'); return false;" data-turbolinks="false">
              <svg enable-background="new 0 0 128 128" version="1.1" viewBox="0 0 128 128" width="20px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="_x35__stroke"><g id="Google_Plus"><rect clip-rule="evenodd" fill="none" fill-rule="evenodd" height="128" width="128"/><path clip-rule="evenodd" d="M40.654,55.935v16.13    c0,0,15.619-0.021,21.979-0.021C59.189,82.5,53.834,88.194,40.654,88.194c-13.338,0-23.748-10.832-23.748-24.194    s10.41-24.194,23.748-24.194c7.052,0,11.607,2.483,15.784,5.944c3.344-3.35,3.065-3.828,11.573-11.877    c-7.222-6.586-16.822-10.6-27.357-10.6C18.201,23.273,0,41.507,0,64c0,22.493,18.201,40.727,40.654,40.727    c33.561,0,41.763-29.275,39.044-48.792H40.654z M113.912,56.742V42.628h-10.063v14.113H89.358v10.081h14.491v14.517h10.063V66.823    H128V56.742H113.912z" fill-rule="evenodd" id="Google_Plus_1_"/></g></g></svg>
            </a>
          </div>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script>
              (function() {
                  var d = document, s = d.createElement('script');
                  s.src = '//nohype-tech.disqus.com/embed.js';
                  s.setAttribute('data-timestamp', +new Date());
                  (d.head || d.body).appendChild(s);
              })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          
        </article>
        <footer class="footer reveal">
  <p>
    Think and <3 ruby
  </p>
</footer>

      </div>
    </div>
  </main>
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Cormorant Garamond:700', 'Lato:300,400,700']
    }
  });
</script>



<script type="text/javascript" src="/assets/vendor.js"></script>
<script type="text/javascript" src="/assets/application.js"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-92620030-1', 'auto');
    ga('send', 'pageview');

</script>
</body>
</html>
